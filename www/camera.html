<!doctype html>
<httpRuntime executionTimeout="90" maxRequestLength="262144" useFullyQualifiedRedirectUrl="false" minFreeThreads="8" minLocalRequestFreeThreads="4" appRequestQueueLimit="100" />
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

        <title>Railway Maintenance</title>

        <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

        <!--     Fonts and icons     -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />

        <!-- CSS Files -->
        <link href="css/bootstrap.min.css" rel="stylesheet" />
        <link href="css/material-kit.css" rel="stylesheet"/>
        <script type="text/javascript" src="js/lz-string.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">
 


  // sets the format of returned value

    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready",onDeviceReady,false);

    // device APIs are available
    //
    function onDeviceReady() {
        pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
    }

    // Called when a photo is successfully retrieved
    //
    function onPhotoDataSuccess(imageData) {
      // Uncomment to view the base64-encoded image data
      // console.log(imageData);

      // Get image handle
      //
      var smallImage = document.getElementById('smallImage');

      // Unhide image elements
      //
      smallImage.style.display = 'block';

      // Show the captured photo
      // The in-line CSS rules are used to resize the image
      //
      smallImage.src = "data:image/jpeg;base64," + imageData;
        
        
        var xu = smallImage.src;
        
      //  sessionStorage.setItem("pic",);
//        function compressImage(){
      //   var comp=LZString.compress(imageData);
//            
        
     
          //  alert("Size of compressToEncodedURIComponent compressed sample is: " + comp.length);
            sessionStorage.setItem("pic",xu);
       // }
      
      
        
    }

    // Called when a photo is successfully retrieved
    //
//    function onPhotoURISuccess(imageURI) {
//      // Uncomment to view the image file URI
//      // console.log(imageURI);
//
//      // Get image handle
//      //
//      var largeImage = document.getElementById('largeImage');
//
//      // Unhide image elements
//      //
//      largeImage.style.display = 'block';
//
//      // Show the captured photo
//      // The in-line CSS rules are used to resize the image
//      //
//      largeImage.src = imageURI;
//    }

    // A button will call this function
    //
    function capturePhoto() {
      // Take picture using device camera and retrieve image as base64-encoded string
      navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50,
        destinationType: destinationType.DATA_URL,targetWidth: 512,
        targetHeight: 512 });
    }

    // A button will call this function
    //
   

    // A button will call this function
    //
//    function getPhoto(source) {
//      // Retrieve image file location from specified source
//      navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50,
//        destinationType: destinationType.FILE_URI,
//        sourceType: source });
//    }

    // Called if something bad happens.
    //
    function onFail(message) {
      alert('Failed because: ' + message);
    }

        function sessionItem(){
            
            
            
             
           
           var x= sessionStorage.getItem("Userid");
            var y =sessionStorage.getItem("trainno");
             var z =sessionStorage.getItem("latitude");
              var a= sessionStorage.getItem("long");
              var pics= sessionStorage.getItem("pic");
            
            postdata(x,y,z,a,pics);
            
        }
//                            jQuery.ajax({
//                    url: "http://66.199.242.90/RailAppApi/RailApp.asmx/InsUpUserFeedbackSuport?TrainNo=" + y + "&UserId=" + x + "&Lat=" + z +"&Lon=" + a + "&Image=" +pics,
//                                
//                    dataType: 'json',
//                    success: function (results) {
//                        
//                       
//                           alert("Successfully Marked Your Attendance")
//                            window.location.href = "dashboard.html";
//                            
//
//                    },
//                    error: function (results)   {
//                                
//                                alert("not send");
//                            }          
//                });
       function postdata(x,y,z,a,p){     
            alert("Upload in Progress! Kindly Wait");
            var data = {
                "TrainNo": y,
                "UserId": x,
                "Lat": z,
                "Lon": a,
                "Image": p

            }
        
            //alert(data[5]);
            
            jQuery.ajax({
                    type: "POST",
                    url: "http://66.199.242.90/railapi/api/train/InsUpUserFeedbackSuport",
//                    xhrFields: {
//
//                        withCredentials: falsex
//                    },
                    headers: {
                        //"authorization": "Basic dWctZ3MtZ2EtbnctYWEwMDI6UGFzc0AxMjM=",
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                   data: JSON.stringify(data),
//                    crossDomain: true,
                    success: function (response) {
//                        inserttodbdata(devui, 'CloseValve', 'BAQBMASDwA==');
//                        var xmlDoc = '';
                        alert("Successfully Marked your Attendance");
                        // alert("Redirecting ! Kindly Click Ok");
                        window.location="dashboard.html";
                        

                    },
                    error: function (result) {
                        //alert('error');
                        return false;

                    }


                });
        }
    </script>
       

    </head>

    <body style="background-color: #eee;" >
        <div class="section" style="margin-bottom: 15px; ">
            <div class="container">
                <nav class="navbar navbar-transparent navbar-fixed-top" role="navigation" >
                    <div class="container">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-index">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>

                            <a href="#">
                                <div class="logo" style="line-height: 50px;">
                                    <img src="img/logo.png" alt="" height="40px">
                                </div>
                            </a>
                        </div>

                        <div class="collapse navbar-collapse" id="navigation-index">
                            <ul class="nav navbar-nav navbar-right">
                               <li>
                                    <a href="dashboard.html">Home</a>
                                </li>
                                <li>
                                    <a href="index.html">Logout</a>
                                </li>

                            </ul>
                        </div>

                    </div><!-- /.container-fluid -->
                </nav>
            </div></div>

        <div class="wrapper">
            <div class="main main-raised" style="padding: 20px;">
                <div class="container">
                    <h3>Capture your Photo</h3>


                    <form>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-12">
                                        
                                        <div class="img-thumbnail" style="height: 280px; width: 280px; margin-left: auto; margin-right: auto; display: block; text-align: center;" onclick="capturePhoto();" >
                                           
                                           <i class="fa fa-camera" style="font-size: 60px; display: block; margin-top: 100px;"></i><span class="blink_text">Click Me</span>
                                            
                                            <img class="img-thumbnail" style="display:none;height: 280px; width: 280px; position: absolute; margin-top: -184px; margin-left: -10px;" id="smallImage" src="" />
    <img style="display:none;" id="largeImage" src="" />
                                        </div> 
                                    </div>
                                       
                                     <div class="col-md-12 ">
                                        <button type="button" style="width: 100%; " class="btn btn-primary pull-right" onclick="sessionItem()" >Save Detail's</button>
                                    </div>
                                    






                                </div>
                            </div>


                        </div><!-- main ROW end-->


                    </form>
                    <br>
                    

                    


                </div>
            </div>

        </div>
        <footer class="footer">
            <div class="container">

                <div class="copyright" style="text-align: center; width: 100%;">
                    &copy; 2018, QuikProto
                </div>
            </div>
        </footer>



    </body>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/material.min.js"></script>

    <!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
    <script src="js/material-kit.js" type="text/javascript"></script>
</html>
